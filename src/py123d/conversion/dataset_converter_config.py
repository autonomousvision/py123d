from __future__ import annotations

from dataclasses import dataclass
from typing import Literal, Optional


@dataclass
class DatasetConverterConfig:
    force_log_conversion: bool = False
    force_map_conversion: bool = False

    # Map
    include_map: bool = False

    # Ego
    include_ego: bool = False

    # Box Detections
    include_box_detections: bool = False
    include_box_lidar_points: bool = False

    # Traffic Lights
    include_traffic_lights: bool = False

    # Pinhole Cameras
    include_pinhole_cameras: bool = False
    pinhole_camera_store_option: Literal["path", "jpeg_binary", "png_binary", "mp4"] = "path"

    # Fisheye MEI Cameras
    include_fisheye_mei_cameras: bool = False
    fisheye_mei_camera_store_option: Literal["path", "jpeg_binary", "png_binary", "mp4"] = "path"

    # Lidars
    include_lidars: bool = False
    lidar_store_option: Literal["path", "binary"] = "path"
    lidar_point_cloud_codec: Literal["laz", "draco", "ipc_zstd", "ipc_lz4", "ipc"] = "draco"
    lidar_point_feature_codec: Optional[Literal["ipc_zstd", "ipc_lz4", "ipc"]] = "ipc_zstd"  # None drops features.

    # Scenario tag / Route
    # NOTE: These are only supported for nuPlan. Consider removing or expanding support.
    include_scenario_tags: bool = False
    include_route: bool = False

    def __post_init__(self):
        assert self.pinhole_camera_store_option in {
            "path",
            "jpeg_binary",
            "png_binary",
            "mp4",
        }, f"Invalid Pinhole camera store option, got {self.pinhole_camera_store_option}."

        assert self.fisheye_mei_camera_store_option in {
            "path",
            "jpeg_binary",
            "png_binary",
            "mp4",
        }, f"Invalid Fisheye MEI camera store option, got {self.fisheye_mei_camera_store_option}."

        # assert self.lidar_store_option in {
        #     "path",
        #     "path_merged",
        #     "laz_binary",
        #     "draco_binary",
        # }, f"Invalid Lidar store option, got {self.lidar_store_option}."
